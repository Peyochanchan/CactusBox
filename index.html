<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- S√©curit√© - Content-Security-Policy (seul header de s√©curit√© fonctionnel via meta tag) -->
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; frame-src https:; connect-src 'self'; font-src 'self' data:;"
    />
    <link rel="stylesheet" href="style.css" />
    <title>Cactus Box - Jazz / Hip-Hop Quatuor</title>
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="favicon.ico" />
    <!-- Configuration de la galerie -->
    <script src="gallery-config.js"></script>
  </head>
  <body>
    <img
      src="images/header_cactus_box.jpg"
      alt="Cactus Box"
      class="header-image"
    />

    <div style="padding: 20px">
      <div class="container">
        <h1>Cactus Box</h1>
        <h2>Jazz / Hip-Hop Quatuor</h2>
        <p class="instruments">Piano ~ Beatbox ~ Trombone ~ Rap ~ Chant</p>

        <div class="nav-buttons">
          <button class="nav-button active" onclick="showSection('bio', this)">
            üìñ Biographie
          </button>
          <button class="nav-button" onclick="showSection('videos', this)">
            üé¨ Vid√©os
          </button>
          <button class="nav-button" onclick="showSection('press', this)">
            üìÅ Dossier Technique
          </button>
          <button class="nav-button" onclick="showSection('gallery', this)">
            üì∏ Galerie
          </button>
        </div>

        <div id="bio" class="content-section active">
          <p class="description">
            Cactus Box, un quartet musical √† la cr√©ativit√© d√©bordante, allie
            rap, chant, beatbox, piano et cuivres dans une alchimie sonore
            unique.
          </p>

          <p class="description">
            Peio, √† la voix rocailleuse, aux improvisations clavier √©clectiques
            et aux couleurs pianistiques singuli√®res, s'allie √† Joos, artisan du
            groove buccal aux beats in√©puisables. Daemon, rappeur improvisateur
            au flow marseillais imparable, √©lectrise l'audience, tandis que
            Matthew au trombone fa√ßonne une texture sonore velout√©e.
          </p>

          <p class="description">
            Ensemble, ils transcendent leurs influences pour cr√©er un ¬´ soul
            blues hiphop ¬ª √† la fois vintage et r√©solument contemporain. Leurs
            improvisations vocales et rythmiques, teint√©es de po√©sie, invitent √†
            la danse et √† l'√©vasion.
          </p>

          <p class="description">
            Cactus Box offre une exp√©rience musicale unique, o√π la bienveillance
            et l'√©nergie du Sud se m√™lent pour captiver et transporter le
            public.
          </p>

          <div style="margin-top: 50px">
            <img
              src="images/favicon_fond_blanc.png"
              alt="CactusBox Logo"
              class="logo-image"
            />
          </div>
          <div class="links-section">
            <h3 class="links-title">En savoir plus</h3>
            <div class="links-container">
              <a
                href="https://www.marsoleil-production.com/cactus-box/"
                target="_blank"
                rel="noopener noreferrer"
                class="link-button"
              >
                üéµ Marsoleil Production
              </a>
              <a
                href="https://www.youtube.com/@cactusboxband"
                target="_blank"
                rel="noopener noreferrer"
                class="link-button"
              >
                üì∫ Cha√Æne YouTube
              </a>
            </div>
          </div>
        </div>

        <div id="videos" class="content-section">
          <h3 class="links-title">Nos Vid√©os</h3>
          <div class="videos-grid">
            <div class="video-wrapper">
              <iframe
                src="https://www.youtube.com/embed/6Zflni6qctQ"
                title="Cactus Box - Vid√©o 1"
                frameborder="0"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                allowfullscreen
              ></iframe>
            </div>
            <div class="video-wrapper">
              <iframe
                src="https://www.youtube.com/embed/I5nsEXe-XPY"
                title="Cactus Box - Vid√©o 2"
                frameborder="0"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                allowfullscreen
              ></iframe>
            </div>
            <div class="video-wrapper">
              <iframe
                src="https://www.youtube.com/embed/fXTZ3f84b9A"
                title="Cactus Box - Vid√©o 3"
                frameborder="0"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                allowfullscreen
              ></iframe>
            </div>
            <div class="video-wrapper">
              <iframe
                src="https://www.youtube.com/embed/UZvsjaGjaYA"
                title="Cactus Box - Vid√©o 4"
                frameborder="0"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                allowfullscreen
              ></iframe>
            </div>
          </div>
          <div class="links-section">
            <a
              href="https://youtube.com/@cactusboxband?si=X24F-4RE2OVfJwTH"
              target="_blank"
              rel="noopener noreferrer"
              class="link-button"
            >
              üé¨ Toutes les vid√©os
            </a>
          </div>
        </div>

        <div id="press" class="content-section">
          <h3 class="links-title">Dossier Technique</h3>
          <p
            class="description"
            style="text-align: center; margin-bottom: 40px"
          >
            Retrouvez toutes les informations professionnelles, photos haute
            r√©solution et contenus m√©dias de Cactus Box.
          </p>
          <div class="links-container">
            <a href="dossier/dossier_site_web.zip" class="link-button">
              üìÅ T√©l√©charger le Dossier Technique
            </a>
          </div>
        </div>

        <div id="gallery" class="content-section">
          <h3 class="links-title">Galerie Photos</h3>
          <div class="carousel-container">
            <div class="carousel-wrapper">
              <button
                class="carousel-button carousel-prev"
                onclick="changeSlide(-1)"
                aria-label="Image pr√©c√©dente"
              >
                &#8249;
              </button>
              <div class="carousel-slides" id="carouselSlides"></div>
              <button
                class="carousel-button carousel-next"
                onclick="changeSlide(1)"
                aria-label="Image suivante"
              >
                &#8250;
              </button>
            </div>
            <div class="carousel-indicators" id="carouselIndicators"></div>
            <div class="carousel-counter" id="carouselCounter"></div>
          </div>
        </div>
        <footer class="site-footer">
          <div class="footer-content">
            <div class="footer-info">
              <p class="footer-group">Cactus Box</p>
              <p class="footer-contact">
                <a href="mailto:contact@cactusbox.art">contact@cactusbox.art</a>
              </p>
              <div class="social-links">
                <a
                  href="https://www.instagram.com/cactusboxband"
                  target="_blank"
                  rel="noopener noreferrer"
                  class="social-link instagram"
                >
                  <svg
                    class="social-icon"
                    viewBox="0 0 24 24"
                    fill="currentColor"
                  >
                    <path
                      d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"
                    />
                  </svg>
                </a>
                <a
                  href="https://www.facebook.com/cactusboxband"
                  target="_blank"
                  rel="noopener noreferrer"
                  class="social-link facebook"
                >
                  <svg
                    class="social-icon"
                    viewBox="0 0 24 24"
                    fill="currentColor"
                  >
                    <path
                      d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"
                    />
                  </svg>
                </a>
              </div>
            </div>
          </div>
        </footer>
      </div>
    </div>

    <script>
      function showSection(sectionId, buttonElement) {
        const sections = document.querySelectorAll(".content-section");
        const buttons = document.querySelectorAll(".nav-button");

        sections.forEach((section) => {
          section.classList.remove("active");
        });

        buttons.forEach((button) => {
          button.classList.remove("active");
        });

        document.getElementById(sectionId).classList.add("active");
        if (buttonElement) {
          buttonElement.classList.add("active");
        }

        // Charger les vid√©os seulement quand la section vid√©os est active
        if (sectionId === "videos") {
          loadVideos();
        }

        // Initialiser le carrousel quand la section galerie est active
        if (sectionId === "gallery") {
          // R√©initialiser l'√©tat du carrousel
          currentSlideIndex = 0;
          setTimeout(() => {
            try {
              initCarousel();
            } catch (error) {
              console.error(
                "Erreur lors de l'initialisation du carrousel:",
                error
              );
              const slidesContainer = document.getElementById("carouselSlides");
              if (slidesContainer) {
                slidesContainer.innerHTML =
                  '<p style="text-align: center; color: #f39c12; padding: 40px;">Erreur lors du chargement de la galerie. Veuillez r√©essayer.</p>';
              }
            }
          }, 100);
        }
      }

      function loadVideos() {
        const videoWrappers = document.querySelectorAll(".video-wrapper");
        videoWrappers.forEach((wrapper, index) => {
          const iframe = wrapper.querySelector("iframe");
          if (iframe && !wrapper.classList.contains("loaded")) {
            // Ajouter un d√©lai pour un chargement progressif
            setTimeout(() => {
              // Marquer comme charg√© imm√©diatement
              wrapper.classList.add("loaded");
              iframe.dataset.loaded = "true";
            }, index * 200); // D√©lai de 200ms entre chaque vid√©o
          }
        });
      }

      // Charger les vid√©os au scroll pour optimiser les performances
      function handleScroll() {
        const videosSection = document.getElementById("videos");
        if (videosSection && videosSection.classList.contains("active")) {
          const rect = videosSection.getBoundingClientRect();
          if (rect.top < window.innerHeight && rect.bottom > 0) {
            loadVideos();
            window.removeEventListener("scroll", handleScroll);
          }
        }
      }

      window.addEventListener("scroll", handleScroll);

      // Configuration s√©curis√©e du carrousel - charg√©e depuis un fichier externe
      let galleryImages = [];
      let currentSlideIndex = 0;
      let galleryConfigLoaded = false;

      // Fonction de validation s√©curis√©e des URLs d'images
      function isValidImageUrl(url) {
        if (!url || typeof url !== "string") return false;
        // V√©rifier que l'URL commence par "images/" (chemin relatif s√©curis√©)
        if (!url.startsWith("images/")) return false;
        // V√©rifier l'extension de fichier (insensible √† la casse)
        const allowedExtensions = [".jpg", ".jpeg", ".png", ".gif", ".webp"];
        const lowerUrl = url.toLowerCase();
        return allowedExtensions.some((ext) => lowerUrl.endsWith(ext));
      }

      // Charger la configuration depuis le fichier JavaScript externe
      // Cette m√©thode fonctionne m√™me avec file:// (pas de probl√®me CORS)
      function loadGalleryConfig() {
        if (galleryConfigLoaded) {
          return galleryImages;
        }

        try {
          // V√©rifier si la configuration est disponible dans window.GALLERY_CONFIG
          if (typeof window.GALLERY_CONFIG === "undefined") {
            throw new Error(
              "Configuration de la galerie non trouv√©e. V√©rifiez que gallery-config.js est charg√©."
            );
          }

          const config = window.GALLERY_CONFIG;
          // Valider la structure de la configuration
          if (!config || !Array.isArray(config.images)) {
            throw new Error("Format de configuration invalide");
          }

          // Valider et filtrer les images
          galleryImages = config.images.filter((img) => {
            if (!img || !img.src) {
              console.warn("Image invalide (pas de src):", img);
              return false;
            }
            const isValid = isValidImageUrl(img.src);
            if (!isValid) {
              console.warn("URL d'image invalide:", img.src);
            }
            return isValid;
          });

          galleryConfigLoaded = true;
          return galleryImages;
        } catch (error) {
          console.error(
            "Erreur lors du chargement de la configuration:",
            error
          );

          // Fallback vers une configuration par d√©faut vide
          galleryImages = [];
          return galleryImages;
        }
      }

      // Fonction de sanitisation pour pr√©venir XSS
      function sanitizeText(text) {
        const div = document.createElement("div");
        div.textContent = text;
        return div.innerHTML;
      }

      // Initialisation du carrousel
      function initCarousel() {
        const slidesContainer = document.getElementById("carouselSlides");
        const indicatorsContainer =
          document.getElementById("carouselIndicators");

        if (!slidesContainer || !indicatorsContainer) return;

        // Charger la configuration si ce n'est pas d√©j√† fait
        loadGalleryConfig();

        // Nettoyer les conteneurs
        slidesContainer.innerHTML = "";
        indicatorsContainer.innerHTML = "";

        if (galleryImages.length === 0) {
          console.error("Aucune image disponible - galleryImages est vide");
          slidesContainer.innerHTML =
            '<p style="text-align: center; color: #f39c12; padding: 40px;">Aucune image disponible dans la galerie.<br><small style="font-size: 0.8em;">V√©rifiez la console pour plus de d√©tails.</small></p>';
          return;
        }

        // Filtrer les images valides
        const validImages = galleryImages.filter((img) => {
          return img && img.src && isValidImageUrl(img.src);
        });

        if (validImages.length === 0) {
          slidesContainer.innerHTML =
            '<p style="text-align: center; color: #f39c12; padding: 40px;">Aucune image valide dans la galerie.</p>';
          return;
        }

        // R√©initialiser l'index si n√©cessaire
        if (currentSlideIndex >= validImages.length) {
          currentSlideIndex = 0;
        }

        // Cr√©er les slides et indicateurs
        validImages.forEach((image, index) => {
          // Cr√©er le slide
          const slide = document.createElement("div");
          slide.className = `carousel-slide ${index === 0 ? "active" : ""}`;
          slide.setAttribute("data-index", index);

          const img = document.createElement("img");
          img.src = sanitizeText(image.src);
          img.alt = sanitizeText(image.alt || `Image ${index + 1}`);
          img.loading = "lazy";
          img.decoding = "async";
          img.onerror = function () {
            console.warn("Erreur de chargement d'image:", image.src);
            // Masquer le slide en cas d'erreur
            slide.style.display = "none";
          };
          img.onload = function () {
            // S'assurer que l'image est visible une fois charg√©e
            slide.style.display = "";
          };

          slide.appendChild(img);
          slidesContainer.appendChild(slide);

          // Cr√©er l'indicateur
          const indicator = document.createElement("button");
          indicator.className = `carousel-indicator ${
            index === 0 ? "active" : ""
          }`;
          indicator.setAttribute("aria-label", `Aller √† l'image ${index + 1}`);
          indicator.onclick = () => goToSlide(index);
          indicatorsContainer.appendChild(indicator);
        });

        // R√©initialiser l'index au premier slide
        currentSlideIndex = 0;
        updateCarousel();
      }

      // Fonction pour changer de slide
      function changeSlide(direction) {
        const slides = document.querySelectorAll(".carousel-slide");
        const totalSlides = slides.length;

        if (totalSlides === 0) return;

        currentSlideIndex += direction;

        if (currentSlideIndex < 0) {
          currentSlideIndex = totalSlides - 1;
        } else if (currentSlideIndex >= totalSlides) {
          currentSlideIndex = 0;
        }

        updateCarousel();
      }

      // Fonction pour aller √† un slide sp√©cifique
      function goToSlide(index) {
        const slides = document.querySelectorAll(".carousel-slide");
        const totalSlides = slides.length;

        if (index >= 0 && index < totalSlides) {
          currentSlideIndex = index;
          updateCarousel();
        }
      }

      // Mise √† jour de l'affichage du carrousel
      function updateCarousel() {
        const slides = document.querySelectorAll(".carousel-slide");
        const indicators = document.querySelectorAll(".carousel-indicator");
        const counter = document.getElementById("carouselCounter");

        slides.forEach((slide, index) => {
          if (index === currentSlideIndex) {
            slide.classList.add("active");
          } else {
            slide.classList.remove("active");
          }
        });

        indicators.forEach((indicator, index) => {
          if (index === currentSlideIndex) {
            indicator.classList.add("active");
          } else {
            indicator.classList.remove("active");
          }
        });

        if (counter) {
          const totalSlides = slides.length;
          counter.textContent = `${currentSlideIndex + 1} / ${totalSlides}`;
        }
      }

      // Navigation au clavier pour l'accessibilit√©
      document.addEventListener("keydown", function (event) {
        const gallerySection = document.getElementById("gallery");
        if (gallerySection && gallerySection.classList.contains("active")) {
          if (event.key === "ArrowLeft") {
            changeSlide(-1);
          } else if (event.key === "ArrowRight") {
            changeSlide(1);
          }
        }
      });
    </script>
  </body>
</html>
